<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <title>Registar Instalação</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <!-- Reutiliza o teu header/nav -->
  <header>
    <!-- ... -->
  </header>

  <main class="content">
    <h1>Registar Instalação de Painéis Solares</h1>

    <form id="installationForm" class="form-installation">
      <label for="installDate">Data da Instalação</label>
      <input type="date" id="installDate" name="installDate" required>

      <label for="address">Morada</label>
      <textarea id="address" name="address" rows="2" required></textarea>

      <label for="panelCount">Número de Painéis</label>
      <input type="number" id="panelCount" name="panelCount" min="1" required>

      <label for="capacityKw">Potência (kW)</label>
      <input type="number" id="capacityKw" name="capacityKw" step="0.01" min="0" required>

      <button type="submit">Submeter</button>
    </form>

    <div id="message" class="form-message"></div>
  </main>

  <script>
  const API_URL = "http://localhost:3000"; // ajusta a porta se for diferente

  document.getElementById('installationForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const installDate  = document.getElementById('installDate').value;
    const address      = document.getElementById('address').value.trim();
    const panelCount   = parseInt(document.getElementById('panelCount').value, 10);
    const capacityKw   = parseFloat(document.getElementById('capacityKw').value);
    const token        = localStorage.getItem('token');

    try {
      const res = await fetch(`${API_URL}/api/installations`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ installDate, address, panelCount, capacityKw })
      });

      const data = await res.json();
      const msgEl = document.getElementById('message');

      if (res.ok) {
        msgEl.textContent = '✅ ' + data.message;
        this.reset();
      } else {
        msgEl.textContent = '⚠️ ' + (data.message || 'Erro ao registar instalação');
      }
    } catch (err) {
      document.getElementById('message').textContent = '❌ Erro de rede.';
      console.error(err);
    }
  });
</script>

</body>
</html>
